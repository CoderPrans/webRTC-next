{"version":3,"file":"static/webpack/static/development/pages/index.js.4c1e69df85959378594e.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import Layout from '../components/layout.js';\nimport {useState, useEffect} from 'react';\n\nconst IndexPage = () => {\n  const [name, setName] = useState('');\n  const [showbox, setShowbox] = useState(true);\n\n  const doChatShit = () => {\n    alert(`Welcome ${name}`);\n    setShowbox(false);\n  };\n\n  useEffect(() => {\n    console.log(location);\n    RTCinit();\n  });\n\n  async function RTCinit() {\n    if (!location.hash) {\n      location.hash = Math.floor(Math.random() * 0xffffff).toString(16);\n    }\n    const chatHash = location.hash.substring(1);\n\n    const configuration = {\n      iceServers: [\n        {\n          url: 'stun:stun.l.google.com:19302',\n        },\n      ],\n    };\n    // RTCPeerConnection\n    let pc;\n    // RTCDataChannel\n    let dataChannel;\n\n    const drone = new Scaledrone('c4l8B2ejDQcIBLKi');\n\n    const roomName = `observable-${chatHash}`;\n\n    let room;\n\n    // Wait for Scaledrone signaling server to connect\n    drone.on('open', async function(error) {\n      if (error) {\n        return console.error(error);\n      }\n      room = drone.subscribe(roomName);\n      room.on('open', error => {\n        if (error) {\n          return console.error(error);\n        }\n        console.log('Connected to signaling server');\n      });\n      // We're connected to the room and received an array of 'members'\n      // connected to the room (including us). Signaling server is ready.\n      room.on('members', async function(members) {\n        if (members.length >= 3) {\n          return alert('The room is full');\n        }\n        // If we are the second user to connect to the room we will be creating the offer\n        const isOfferer = members.length === 2;\n        await startWebRTC(isOfferer);\n      });\n    });\n\n    // Send signaling data via Scaledrone\n    function sendSignalingMessage(message) {\n      drone.publish({\n        room: roomName,\n        message,\n      });\n    }\n\n    function startWebRTC(isOfferer) {\n      console.log('Starting WebRTC in as', isOfferer ? 'offerer' : 'waiter');\n      pc = new RTCPeerConnection(configuration);\n\n      // 'onicecandidate' notifies us whenever an ICE agent needs to deliver a\n      // message to the other peer through the signaling server\n      pc.onicecandidate = event => {\n        if (event.candidate) {\n          sendSignalingMessage({candidate: event.candidate});\n        }\n      };\n\n      if (isOfferer) {\n        // If user is offerer let them create a negotiation offer and set up the data channel\n        pc.onnegotiationneeded = () => {\n          pc.createOffer(localDescCreated, error => console.error(error));\n        };\n        dataChannel = pc.createDataChannel('chat');\n        setupDataChannel();\n      } else {\n        // If user is not the offerer let wait for a data channel\n        pc.ondatachannel = event => {\n          dataChannel = event.channel;\n          setupDataChannel();\n        };\n      }\n\n      startListentingToSignals();\n    }\n  }\n\n  return (\n    <Layout>\n      <h1>Welcome to Web-Chat{!showbox && `, ${name}`}</h1>\n      {showbox && (\n        <div className=\"welcome-box\">\n          <input\n            placeholder=\"your name ?\"\n            onChange={e => setName(e.target.value)}\n            onKeyPress={e => {\n              e.which === 13 ? doChatShit() : null;\n            }}\n            value={name}\n            style={{\n              width: 130,\n              padding: '8px',\n              margin: '10px',\n              fontSize: 16,\n              borderRadius: 2,\n              border: '1px solid #DDD',\n            }}\n          />\n          <br />\n          <button onClick={doChatShit}>Enter</button>\n        </div>\n      )}\n      <style jsx>{`\n        h1 {\n          font-family: Arial;\n        }\n        button {\n          padding: 8px;\n          margin: 0 10px;\n          font-size: 15px;\n          font-style: bold;\n          background-color: #4285f4;\n          border-radius: 3px;\n          color: white;\n          border: none;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default IndexPage;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAcA;AAAA;AAAA;AAAA;AAAA;AAwDA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApCA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAtDA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AADA;AAFA;AACA;AAWA;AAEA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AALA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AA1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAdA;AAAA;AACA;AAoGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AArBA;AAAA;AAAA;AAyCA;AACA;AACA;;;;A","sourceRoot":""}