{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/coder-prans/Desktop/develop.../web-chat/pages/index.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nimport Layout from '../components/layout.js';\nimport { useState, useEffect } from 'react';\n\nvar IndexPage = function IndexPage() {\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      name = _useState2[0],\n      setName = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showbox = _useState4[0],\n      setShowbox = _useState4[1];\n\n  var doChatShit = function doChatShit() {\n    alert(\"Welcome \".concat(name));\n    setShowbox(false);\n  };\n\n  useEffect(function () {\n    console.log(location);\n    RTCinit();\n  });\n\n  function RTCinit() {\n    if (!location.hash) {\n      location.hash = Math.floor(Math.random() * 0xffffff).toString(16);\n    }\n\n    var chatHash = location.hash.substring(1);\n    var configuration = {\n      iceServers: [{\n        url: 'stun:stun.l.google.com:19302'\n      }]\n    }; // RTCPeerConnection\n\n    var pc; // RTCDataChannel\n\n    var dataChannel;\n    var drone = new Scaledrone('c4l8B2ejDQcIBLKi');\n    var roomName = \"observable-\".concat(chatHash);\n    var room; // Wait for Scaledrone signaling server to connect\n\n    drone.on('open', function (error) {\n      if (error) {\n        return console.error(error);\n      }\n\n      room = drone.subscribe(roomName);\n      room.on('open', function (error) {\n        if (error) {\n          return console.error(error);\n        }\n\n        console.log('Connected to signaling server');\n      }); // We're connected to the room and received an array of 'members'\n      // connected to the room (including us). Signaling server is ready.\n\n      room.on('members', function (members) {\n        if (members.length >= 3) {\n          return alert('The room is full');\n        } // If we are the second user to connect to the room we will be creating the offer\n\n\n        var isOfferer = members.length === 2;\n        startWebRTC(isOfferer);\n      });\n    }); // Send signaling data via Scaledrone\n\n    function sendSignalingMessage(message) {\n      drone.publish({\n        room: roomName,\n        message: message\n      });\n    }\n\n    function startWebRTC(isOfferer) {\n      console.log('Starting WebRTC in as', isOfferer ? 'offerer' : 'waiter');\n      pc = new RTCPeerConnection(configuration); // 'onicecandidate' notifies us whenever an ICE agent needs to deliver a\n      // message to the other peer through the signaling server\n\n      pc.onicecandidate = function (event) {\n        if (event.candidate) {\n          sendSignalingMessage({\n            candidate: event.candidate\n          });\n        }\n      };\n\n      if (isOfferer) {\n        // If user is offerer let them create a negotiation offer and set up the data channel\n        pc.onnegotiationneeded = function () {\n          pc.createOffer(localDescCreated, function (error) {\n            return console.error(error);\n          });\n        };\n\n        dataChannel = pc.createDataChannel('chat');\n        setupDataChannel();\n      } else {\n        // If user is not the offerer let wait for a data channel\n        pc.ondatachannel = function (event) {\n          dataChannel = event.channel;\n          setupDataChannel();\n        };\n      }\n\n      startListentingToSignals();\n    }\n\n    function setupDataChannel() {\n      checkDataChannelState();\n      dataChannel.onopen = checkDataChannelState;\n      dataChannel.onclose = checkDataChannelState;\n\n      dataChannel.onmessage = function (event) {\n        return insertMessageToDOM(JSON.parse(event.data), false);\n      };\n    }\n\n    function checkDataChannelState() {\n      console.log('WebRTC channel state is:', dataChannel.readyState);\n\n      if (dataChannel.readyState === 'open') {\n        insertMessageToDOM({\n          content: 'WebRTC data channel is now open'\n        });\n      }\n    }\n\n    function startListentingToSignals() {\n      // Listen to signaling data from Scaledrone\n      room.on('data', function (message, client) {\n        // Message was sent by us\n        if (client.id === drone.clientId) {\n          return;\n        }\n\n        if (message.sdp) {\n          // This is called after receiving an offer or answer from another peer\n          pc.setRemoteDescription(new RTCSessionDescription(message.sdp), function () {\n            console.log('pc.remoteDescription.type', pc.remoteDescription.type); // When receiving an offer lets answer it\n\n            if (pc.remoteDescription.type === 'offer') {\n              console.log('Answering offer');\n              pc.createAnswer(localDescCreated, function (error) {\n                return console.error(error);\n              });\n            }\n          }, function (error) {\n            return console.error(error);\n          });\n        } else if (message.candidate) {\n          // Add the new ICE candidate to our connections remote description\n          pc.addIceCandidate(new RTCIceCandidate(message.candidate));\n        }\n      });\n    }\n  }\n\n  return React.createElement(Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    className: \"jsx-2332887812\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, \"Welcome to Web-Chat\", !showbox && \", \".concat(name)), showbox && React.createElement(\"div\", {\n    className: \"jsx-2332887812\" + \" \" + \"welcome-box\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    placeholder: \"your name ?\",\n    onChange: function onChange(e) {\n      return setName(e.target.value);\n    },\n    onKeyPress: function onKeyPress(e) {\n      e.which === 13 ? doChatShit() : null;\n    },\n    value: name,\n    style: {\n      width: 130,\n      padding: '8px',\n      margin: '10px',\n      fontSize: 16,\n      borderRadius: 2,\n      border: '1px solid #DDD'\n    },\n    className: \"jsx-2332887812\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    className: \"jsx-2332887812\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    onClick: doChatShit,\n    className: \"jsx-2332887812\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, \"Enter\")), React.createElement(_JSXStyle, {\n    id: \"2332887812\",\n    __self: this\n  }, \"h1.jsx-2332887812{font-family:Arial;}button.jsx-2332887812{padding:8px;margin:0 10px;font-size:15px;font-style:bold;background-color:#4285f4;border-radius:3px;color:white;border:none;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2NvZGVyLXByYW5zL0Rlc2t0b3AvZGV2ZWxvcC4uLi93ZWItY2hhdC9wYWdlcy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFnTGtCLEFBRzZCLEFBR04sWUFDRSxNQUhoQixRQUlpQixlQUNDLGdCQUNTLHlCQUNQLGtCQUNOLFlBQ0EsWUFDZCIsImZpbGUiOiIvaG9tZS9jb2Rlci1wcmFucy9EZXNrdG9wL2RldmVsb3AuLi4vd2ViLWNoYXQvcGFnZXMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTGF5b3V0IGZyb20gJy4uL2NvbXBvbmVudHMvbGF5b3V0LmpzJztcbmltcG9ydCB7dXNlU3RhdGUsIHVzZUVmZmVjdH0gZnJvbSAncmVhY3QnO1xuXG5jb25zdCBJbmRleFBhZ2UgPSAoKSA9PiB7XG4gIGNvbnN0IFtuYW1lLCBzZXROYW1lXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW3Nob3dib3gsIHNldFNob3dib3hdID0gdXNlU3RhdGUodHJ1ZSk7XG5cbiAgY29uc3QgZG9DaGF0U2hpdCA9ICgpID0+IHtcbiAgICBhbGVydChgV2VsY29tZSAke25hbWV9YCk7XG4gICAgc2V0U2hvd2JveChmYWxzZSk7XG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhsb2NhdGlvbik7XG4gICAgUlRDaW5pdCgpO1xuICB9KTtcblxuICBmdW5jdGlvbiBSVENpbml0KCkge1xuICAgIGlmICghbG9jYXRpb24uaGFzaCkge1xuICAgICAgbG9jYXRpb24uaGFzaCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmKS50b1N0cmluZygxNik7XG4gICAgfVxuICAgIGNvbnN0IGNoYXRIYXNoID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSk7XG5cbiAgICBjb25zdCBjb25maWd1cmF0aW9uID0ge1xuICAgICAgaWNlU2VydmVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgdXJsOiAnc3R1bjpzdHVuLmwuZ29vZ2xlLmNvbToxOTMwMicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH07XG4gICAgLy8gUlRDUGVlckNvbm5lY3Rpb25cbiAgICBsZXQgcGM7XG4gICAgLy8gUlRDRGF0YUNoYW5uZWxcbiAgICBsZXQgZGF0YUNoYW5uZWw7XG5cbiAgICBjb25zdCBkcm9uZSA9IG5ldyBTY2FsZWRyb25lKCdjNGw4QjJlakRRY0lCTEtpJyk7XG5cbiAgICBjb25zdCByb29tTmFtZSA9IGBvYnNlcnZhYmxlLSR7Y2hhdEhhc2h9YDtcblxuICAgIGxldCByb29tO1xuXG4gICAgLy8gV2FpdCBmb3IgU2NhbGVkcm9uZSBzaWduYWxpbmcgc2VydmVyIHRvIGNvbm5lY3RcbiAgICBkcm9uZS5vbignb3BlbicsIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgICAgcm9vbSA9IGRyb25lLnN1YnNjcmliZShyb29tTmFtZSk7XG4gICAgICByb29tLm9uKCdvcGVuJywgZXJyb3IgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCB0byBzaWduYWxpbmcgc2VydmVyJyk7XG4gICAgICB9KTtcbiAgICAgIC8vIFdlJ3JlIGNvbm5lY3RlZCB0byB0aGUgcm9vbSBhbmQgcmVjZWl2ZWQgYW4gYXJyYXkgb2YgJ21lbWJlcnMnXG4gICAgICAvLyBjb25uZWN0ZWQgdG8gdGhlIHJvb20gKGluY2x1ZGluZyB1cykuIFNpZ25hbGluZyBzZXJ2ZXIgaXMgcmVhZHkuXG4gICAgICByb29tLm9uKCdtZW1iZXJzJywgZnVuY3Rpb24obWVtYmVycykge1xuICAgICAgICBpZiAobWVtYmVycy5sZW5ndGggPj0gMykge1xuICAgICAgICAgIHJldHVybiBhbGVydCgnVGhlIHJvb20gaXMgZnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGFyZSB0aGUgc2Vjb25kIHVzZXIgdG8gY29ubmVjdCB0byB0aGUgcm9vbSB3ZSB3aWxsIGJlIGNyZWF0aW5nIHRoZSBvZmZlclxuICAgICAgICBjb25zdCBpc09mZmVyZXIgPSBtZW1iZXJzLmxlbmd0aCA9PT0gMjtcbiAgICAgICAgc3RhcnRXZWJSVEMoaXNPZmZlcmVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gU2VuZCBzaWduYWxpbmcgZGF0YSB2aWEgU2NhbGVkcm9uZVxuICAgIGZ1bmN0aW9uIHNlbmRTaWduYWxpbmdNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgIGRyb25lLnB1Ymxpc2goe1xuICAgICAgICByb29tOiByb29tTmFtZSxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0YXJ0V2ViUlRDKGlzT2ZmZXJlcikge1xuICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIFdlYlJUQyBpbiBhcycsIGlzT2ZmZXJlciA/ICdvZmZlcmVyJyA6ICd3YWl0ZXInKTtcbiAgICAgIHBjID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGNvbmZpZ3VyYXRpb24pO1xuXG4gICAgICAvLyAnb25pY2VjYW5kaWRhdGUnIG5vdGlmaWVzIHVzIHdoZW5ldmVyIGFuIElDRSBhZ2VudCBuZWVkcyB0byBkZWxpdmVyIGFcbiAgICAgIC8vIG1lc3NhZ2UgdG8gdGhlIG90aGVyIHBlZXIgdGhyb3VnaCB0aGUgc2lnbmFsaW5nIHNlcnZlclxuICAgICAgcGMub25pY2VjYW5kaWRhdGUgPSBldmVudCA9PiB7XG4gICAgICAgIGlmIChldmVudC5jYW5kaWRhdGUpIHtcbiAgICAgICAgICBzZW5kU2lnbmFsaW5nTWVzc2FnZSh7Y2FuZGlkYXRlOiBldmVudC5jYW5kaWRhdGV9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaWYgKGlzT2ZmZXJlcikge1xuICAgICAgICAvLyBJZiB1c2VyIGlzIG9mZmVyZXIgbGV0IHRoZW0gY3JlYXRlIGEgbmVnb3RpYXRpb24gb2ZmZXIgYW5kIHNldCB1cCB0aGUgZGF0YSBjaGFubmVsXG4gICAgICAgIHBjLm9ubmVnb3RpYXRpb25uZWVkZWQgPSAoKSA9PiB7XG4gICAgICAgICAgcGMuY3JlYXRlT2ZmZXIobG9jYWxEZXNjQ3JlYXRlZCwgZXJyb3IgPT4gY29uc29sZS5lcnJvcihlcnJvcikpO1xuICAgICAgICB9O1xuICAgICAgICBkYXRhQ2hhbm5lbCA9IHBjLmNyZWF0ZURhdGFDaGFubmVsKCdjaGF0Jyk7XG4gICAgICAgIHNldHVwRGF0YUNoYW5uZWwoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIHVzZXIgaXMgbm90IHRoZSBvZmZlcmVyIGxldCB3YWl0IGZvciBhIGRhdGEgY2hhbm5lbFxuICAgICAgICBwYy5vbmRhdGFjaGFubmVsID0gZXZlbnQgPT4ge1xuICAgICAgICAgIGRhdGFDaGFubmVsID0gZXZlbnQuY2hhbm5lbDtcbiAgICAgICAgICBzZXR1cERhdGFDaGFubmVsKCk7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0TGlzdGVudGluZ1RvU2lnbmFscygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldHVwRGF0YUNoYW5uZWwoKSB7XG4gICAgICBjaGVja0RhdGFDaGFubmVsU3RhdGUoKTtcbiAgICAgIGRhdGFDaGFubmVsLm9ub3BlbiA9IGNoZWNrRGF0YUNoYW5uZWxTdGF0ZTtcbiAgICAgIGRhdGFDaGFubmVsLm9uY2xvc2UgPSBjaGVja0RhdGFDaGFubmVsU3RhdGU7XG4gICAgICBkYXRhQ2hhbm5lbC5vbm1lc3NhZ2UgPSBldmVudCA9PlxuICAgICAgICBpbnNlcnRNZXNzYWdlVG9ET00oSlNPTi5wYXJzZShldmVudC5kYXRhKSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrRGF0YUNoYW5uZWxTdGF0ZSgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdXZWJSVEMgY2hhbm5lbCBzdGF0ZSBpczonLCBkYXRhQ2hhbm5lbC5yZWFkeVN0YXRlKTtcbiAgICAgIGlmIChkYXRhQ2hhbm5lbC5yZWFkeVN0YXRlID09PSAnb3BlbicpIHtcbiAgICAgICAgaW5zZXJ0TWVzc2FnZVRvRE9NKHtjb250ZW50OiAnV2ViUlRDIGRhdGEgY2hhbm5lbCBpcyBub3cgb3Blbid9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gc3RhcnRMaXN0ZW50aW5nVG9TaWduYWxzKCkge1xuICAgICAgLy8gTGlzdGVuIHRvIHNpZ25hbGluZyBkYXRhIGZyb20gU2NhbGVkcm9uZVxuICAgICAgcm9vbS5vbignZGF0YScsIChtZXNzYWdlLCBjbGllbnQpID0+IHtcbiAgICAgICAgLy8gTWVzc2FnZSB3YXMgc2VudCBieSB1c1xuICAgICAgICBpZiAoY2xpZW50LmlkID09PSBkcm9uZS5jbGllbnRJZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWVzc2FnZS5zZHApIHtcbiAgICAgICAgICAvLyBUaGlzIGlzIGNhbGxlZCBhZnRlciByZWNlaXZpbmcgYW4gb2ZmZXIgb3IgYW5zd2VyIGZyb20gYW5vdGhlciBwZWVyXG4gICAgICAgICAgcGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oXG4gICAgICAgICAgICBuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKG1lc3NhZ2Uuc2RwKSxcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgJ3BjLnJlbW90ZURlc2NyaXB0aW9uLnR5cGUnLFxuICAgICAgICAgICAgICAgIHBjLnJlbW90ZURlc2NyaXB0aW9uLnR5cGUsXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIC8vIFdoZW4gcmVjZWl2aW5nIGFuIG9mZmVyIGxldHMgYW5zd2VyIGl0XG4gICAgICAgICAgICAgIGlmIChwYy5yZW1vdGVEZXNjcmlwdGlvbi50eXBlID09PSAnb2ZmZXInKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Fuc3dlcmluZyBvZmZlcicpO1xuICAgICAgICAgICAgICAgIHBjLmNyZWF0ZUFuc3dlcihsb2NhbERlc2NDcmVhdGVkLCBlcnJvciA9PlxuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpLFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5jYW5kaWRhdGUpIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIG5ldyBJQ0UgY2FuZGlkYXRlIHRvIG91ciBjb25uZWN0aW9ucyByZW1vdGUgZGVzY3JpcHRpb25cbiAgICAgICAgICBwYy5hZGRJY2VDYW5kaWRhdGUobmV3IFJUQ0ljZUNhbmRpZGF0ZShtZXNzYWdlLmNhbmRpZGF0ZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxMYXlvdXQ+XG4gICAgICA8aDE+V2VsY29tZSB0byBXZWItQ2hhdHshc2hvd2JveCAmJiBgLCAke25hbWV9YH08L2gxPlxuICAgICAge3Nob3dib3ggJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIndlbGNvbWUtYm94XCI+XG4gICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cInlvdXIgbmFtZSA/XCJcbiAgICAgICAgICAgIG9uQ2hhbmdlPXtlID0+IHNldE5hbWUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgb25LZXlQcmVzcz17ZSA9PiB7XG4gICAgICAgICAgICAgIGUud2hpY2ggPT09IDEzID8gZG9DaGF0U2hpdCgpIDogbnVsbDtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICB2YWx1ZT17bmFtZX1cbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIHdpZHRoOiAxMzAsXG4gICAgICAgICAgICAgIHBhZGRpbmc6ICc4cHgnLFxuICAgICAgICAgICAgICBtYXJnaW46ICcxMHB4JyxcbiAgICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDIsXG4gICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjREREJyxcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgLz5cbiAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e2RvQ2hhdFNoaXR9PkVudGVyPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICAgIDxzdHlsZSBqc3g+e2BcbiAgICAgICAgaDEge1xuICAgICAgICAgIGZvbnQtZmFtaWx5OiBBcmlhbDtcbiAgICAgICAgfVxuICAgICAgICBidXR0b24ge1xuICAgICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgICBtYXJnaW46IDAgMTBweDtcbiAgICAgICAgICBmb250LXNpemU6IDE1cHg7XG4gICAgICAgICAgZm9udC1zdHlsZTogYm9sZDtcbiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDI4NWY0O1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDtcbiAgICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgICB9XG4gICAgICBgfTwvc3R5bGU+XG4gICAgPC9MYXlvdXQ+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBJbmRleFBhZ2U7XG4iXX0= */\\n/*@ sourceURL=/home/coder-prans/Desktop/develop.../web-chat/pages/index.js */\"));\n};\n\nexport default IndexPage;","map":{"version":3,"sources":["/home/coder-prans/Desktop/develop.../web-chat/pages/index.js"],"names":["Layout","useState","useEffect","IndexPage","name","setName","showbox","setShowbox","doChatShit","alert","console","log","location","RTCinit","hash","Math","floor","random","toString","chatHash","substring","configuration","iceServers","url","pc","dataChannel","drone","Scaledrone","roomName","room","on","error","subscribe","members","length","isOfferer","startWebRTC","sendSignalingMessage","message","publish","RTCPeerConnection","onicecandidate","event","candidate","onnegotiationneeded","createOffer","localDescCreated","createDataChannel","setupDataChannel","ondatachannel","channel","startListentingToSignals","checkDataChannelState","onopen","onclose","onmessage","insertMessageToDOM","JSON","parse","data","readyState","content","client","id","clientId","sdp","setRemoteDescription","RTCSessionDescription","remoteDescription","type","createAnswer","addIceCandidate","RTCIceCandidate","e","target","value","which","width","padding","margin","fontSize","borderRadius","border"],"mappings":"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","sourcesContent":["import Layout from '../components/layout.js';\nimport {useState, useEffect} from 'react';\n\nconst IndexPage = () => {\n  const [name, setName] = useState('');\n  const [showbox, setShowbox] = useState(true);\n\n  const doChatShit = () => {\n    alert(`Welcome ${name}`);\n    setShowbox(false);\n  };\n\n  useEffect(() => {\n    console.log(location);\n    RTCinit();\n  });\n\n  function RTCinit() {\n    if (!location.hash) {\n      location.hash = Math.floor(Math.random() * 0xffffff).toString(16);\n    }\n    const chatHash = location.hash.substring(1);\n\n    const configuration = {\n      iceServers: [\n        {\n          url: 'stun:stun.l.google.com:19302',\n        },\n      ],\n    };\n    // RTCPeerConnection\n    let pc;\n    // RTCDataChannel\n    let dataChannel;\n\n    const drone = new Scaledrone('c4l8B2ejDQcIBLKi');\n\n    const roomName = `observable-${chatHash}`;\n\n    let room;\n\n    // Wait for Scaledrone signaling server to connect\n    drone.on('open', function(error) {\n      if (error) {\n        return console.error(error);\n      }\n      room = drone.subscribe(roomName);\n      room.on('open', error => {\n        if (error) {\n          return console.error(error);\n        }\n        console.log('Connected to signaling server');\n      });\n      // We're connected to the room and received an array of 'members'\n      // connected to the room (including us). Signaling server is ready.\n      room.on('members', function(members) {\n        if (members.length >= 3) {\n          return alert('The room is full');\n        }\n        // If we are the second user to connect to the room we will be creating the offer\n        const isOfferer = members.length === 2;\n        startWebRTC(isOfferer);\n      });\n    });\n\n    // Send signaling data via Scaledrone\n    function sendSignalingMessage(message) {\n      drone.publish({\n        room: roomName,\n        message,\n      });\n    }\n\n    function startWebRTC(isOfferer) {\n      console.log('Starting WebRTC in as', isOfferer ? 'offerer' : 'waiter');\n      pc = new RTCPeerConnection(configuration);\n\n      // 'onicecandidate' notifies us whenever an ICE agent needs to deliver a\n      // message to the other peer through the signaling server\n      pc.onicecandidate = event => {\n        if (event.candidate) {\n          sendSignalingMessage({candidate: event.candidate});\n        }\n      };\n\n      if (isOfferer) {\n        // If user is offerer let them create a negotiation offer and set up the data channel\n        pc.onnegotiationneeded = () => {\n          pc.createOffer(localDescCreated, error => console.error(error));\n        };\n        dataChannel = pc.createDataChannel('chat');\n        setupDataChannel();\n      } else {\n        // If user is not the offerer let wait for a data channel\n        pc.ondatachannel = event => {\n          dataChannel = event.channel;\n          setupDataChannel();\n        };\n      }\n\n      startListentingToSignals();\n    }\n\n    function setupDataChannel() {\n      checkDataChannelState();\n      dataChannel.onopen = checkDataChannelState;\n      dataChannel.onclose = checkDataChannelState;\n      dataChannel.onmessage = event =>\n        insertMessageToDOM(JSON.parse(event.data), false);\n    }\n\n    function checkDataChannelState() {\n      console.log('WebRTC channel state is:', dataChannel.readyState);\n      if (dataChannel.readyState === 'open') {\n        insertMessageToDOM({content: 'WebRTC data channel is now open'});\n      }\n    }\n    function startListentingToSignals() {\n      // Listen to signaling data from Scaledrone\n      room.on('data', (message, client) => {\n        // Message was sent by us\n        if (client.id === drone.clientId) {\n          return;\n        }\n        if (message.sdp) {\n          // This is called after receiving an offer or answer from another peer\n          pc.setRemoteDescription(\n            new RTCSessionDescription(message.sdp),\n            () => {\n              console.log(\n                'pc.remoteDescription.type',\n                pc.remoteDescription.type,\n              );\n              // When receiving an offer lets answer it\n              if (pc.remoteDescription.type === 'offer') {\n                console.log('Answering offer');\n                pc.createAnswer(localDescCreated, error =>\n                  console.error(error),\n                );\n              }\n            },\n            error => console.error(error),\n          );\n        } else if (message.candidate) {\n          // Add the new ICE candidate to our connections remote description\n          pc.addIceCandidate(new RTCIceCandidate(message.candidate));\n        }\n      });\n    }\n  }\n\n  return (\n    <Layout>\n      <h1>Welcome to Web-Chat{!showbox && `, ${name}`}</h1>\n      {showbox && (\n        <div className=\"welcome-box\">\n          <input\n            placeholder=\"your name ?\"\n            onChange={e => setName(e.target.value)}\n            onKeyPress={e => {\n              e.which === 13 ? doChatShit() : null;\n            }}\n            value={name}\n            style={{\n              width: 130,\n              padding: '8px',\n              margin: '10px',\n              fontSize: 16,\n              borderRadius: 2,\n              border: '1px solid #DDD',\n            }}\n          />\n          <br />\n          <button onClick={doChatShit}>Enter</button>\n        </div>\n      )}\n      <style jsx>{`\n        h1 {\n          font-family: Arial;\n        }\n        button {\n          padding: 8px;\n          margin: 0 10px;\n          font-size: 15px;\n          font-style: bold;\n          background-color: #4285f4;\n          border-radius: 3px;\n          color: white;\n          border: none;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default IndexPage;\n"]},"metadata":{},"sourceType":"module"}