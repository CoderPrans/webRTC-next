{"version":3,"file":"static/development/pages/index.js","sources":["webpack:///webpack/bootstrap","webpack:///./RTCinit.js","webpack:///./components/layout.js","webpack:///./node_modules/@babel/runtime-corejs2/core-js/array/is-array.js","webpack:///./node_modules/@babel/runtime-corejs2/core-js/get-iterator.js","webpack:///./node_modules/@babel/runtime-corejs2/helpers/esm/arrayWithHoles.js","webpack:///./node_modules/@babel/runtime-corejs2/helpers/esm/iterableToArrayLimit.js","webpack:///./node_modules/@babel/runtime-corejs2/helpers/esm/nonIterableRest.js","webpack:///./node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray.js","webpack:///./pages/index.js","webpack:///external \"core-js/library/fn/array/is-array\"","webpack:///external \"core-js/library/fn/get-iterator\"","webpack:///external \"next/head\"","webpack:///external \"react\"","webpack:///external \"styled-jsx/style\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = require('../../../ssr-module-cache.js');\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","export default function RTCinit() {\n  if (!location.hash) {\n    location.hash = Math.floor(Math.random() * 0xffffff).toString(16);\n  }\n  const chatHash = location.hash.substring(1);\n\n  const configuration = {\n    iceServers: [\n      {\n        url: 'stun:stun.l.google.com:19302',\n      },\n    ],\n  };\n  // RTCPeerConnection\n  let pc;\n  // RTCDataChannel\n  let dataChannel;\n\n  const drone = new Scaledrone('c4l8B2ejDQcIBLKi');\n\n  const roomName = `observable-${chatHash}`;\n\n  let room;\n\n  // Wait for Scaledrone signaling server to connect\n  drone.on('open', function(error) {\n    if (error) {\n      return console.error(error);\n    }\n    room = drone.subscribe(roomName);\n    room.on('open', error => {\n      if (error) {\n        return console.error(error);\n      }\n      console.log('Connected to signaling server');\n    });\n    // We're connected to the room and received an array of 'members'\n    // connected to the room (including us). Signaling server is ready.\n    room.on('members', function(members) {\n      if (members.length >= 3) {\n        return alert('The room is full');\n      }\n      // If we are the second user to connect to the room we will be creating the offer\n      const isOfferer = members.length === 2;\n      startWebRTC(isOfferer);\n    });\n  });\n\n  // Send signaling data via Scaledrone\n  function sendSignalingMessage(message) {\n    drone.publish({\n      room: roomName,\n      message,\n    });\n  }\n\n  function startWebRTC(isOfferer) {\n    console.log('Starting WebRTC in as', isOfferer ? 'offerer' : 'waiter');\n    pc = new RTCPeerConnection(configuration);\n\n    // 'onicecandidate' notifies us whenever an ICE agent needs to deliver a\n    // message to the other peer through the signaling server\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        sendSignalingMessage({candidate: event.candidate});\n      }\n    };\n\n    if (isOfferer) {\n      // If user is offerer let them create a negotiation offer and set up the data channel\n      pc.onnegotiationneeded = () => {\n        pc.createOffer(localDescCreated, error => console.error(error));\n      };\n      dataChannel = pc.createDataChannel('chat');\n      setupDataChannel();\n    } else {\n      // If user is not the offerer let wait for a data channel\n      pc.ondatachannel = event => {\n        dataChannel = event.channel;\n        setupDataChannel();\n      };\n    }\n\n    startListentingToSignals();\n  }\n\n  function setupDataChannel() {\n    checkDataChannelState();\n    dataChannel.onopen = checkDataChannelState;\n    dataChannel.onclose = checkDataChannelState;\n    // dataChannel.onmessage = event =>\n    // insertMessageToDOM(JSON.parse(event.data), false);\n  }\n\n  function checkDataChannelState() {\n    console.log('WebRTC channel state is:', dataChannel.readyState);\n    // if (dataChannel.readyState === 'open') {\n    //   insertMessageToDOM({content: 'WebRTC data channel is now open'});\n    // }\n  }\n  function startListentingToSignals() {\n    // Listen to signaling data from Scaledrone\n    room.on('data', (message, client) => {\n      // Message was sent by us\n      if (client.id === drone.clientId) {\n        return;\n      }\n      if (message.sdp) {\n        // This is called after receiving an offer or answer from another peer\n        pc.setRemoteDescription(\n          new RTCSessionDescription(message.sdp),\n          () => {\n            console.log('pc.remoteDescription.type', pc.remoteDescription.type);\n            // When receiving an offer lets answer it\n            if (pc.remoteDescription.type === 'offer') {\n              console.log('Answering offer');\n              pc.createAnswer(localDescCreated, error => console.error(error));\n            }\n          },\n          error => console.error(error),\n        );\n      } else if (message.candidate) {\n        // Add the new ICE candidate to our connections remote description\n        pc.addIceCandidate(new RTCIceCandidate(message.candidate));\n      }\n    });\n  }\n  function localDescCreated(desc) {\n    pc.setLocalDescription(\n      desc,\n      () => sendSignalingMessage({sdp: pc.localDescription}),\n      error => console.error(error),\n    );\n  }\n  alert('Chat location is: ' + location.href);\n}\n","import Head from 'next/head';\n\nconst Layout = ({children}) => (\n  <div>\n    <Head>\n      <title>Web-Chat</title>\n      <script\n        type=\"text/javascript\"\n        src=\"https://cdn.scaledrone.com/scaledrone.min.js\"\n      />\n    </Head>\n    {children}\n  </div>\n);\n\nexport default Layout;\n","module.exports = require(\"core-js/library/fn/array/is-array\");","module.exports = require(\"core-js/library/fn/get-iterator\");","import _Array$isArray from \"../../core-js/array/is-array\";\nexport default function _arrayWithHoles(arr) {\n  if (_Array$isArray(arr)) return arr;\n}","import _getIterator from \"../../core-js/get-iterator\";\nexport default function _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = _getIterator(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}","import Layout from '../components/layout.js';\nimport {useState, useEffect} from 'react';\nimport RTCinit from '../RTCinit.js';\n\nconst IndexPage = () => {\n  const [name, setName] = useState('');\n  const [showbox, setShowbox] = useState(true);\n\n  const doChatShit = () => {\n    alert(`Welcome ${name}`);\n    setShowbox(false);\n  };\n\n  useEffect(() => {\n    console.log(location);\n    RTCinit();\n  });\n\n  return (\n    <Layout>\n      <h1>Welcome to Web-Chat{!showbox && `, ${name}`}</h1>\n      {showbox && (\n        <div className=\"welcome-box\">\n          <input\n            placeholder=\"your name ?\"\n            onChange={e => setName(e.target.value)}\n            onKeyPress={e => {\n              e.which === 13 ? doChatShit() : null;\n            }}\n            value={name}\n            style={{\n              width: 130,\n              padding: '8px',\n              margin: '10px',\n              fontSize: 16,\n              borderRadius: 2,\n              border: '1px solid #DDD',\n            }}\n          />\n          <br />\n          <button onClick={doChatShit}>Enter</button>\n        </div>\n      )}\n      <div className=\"content\">\n        <div className=\"messages\" />\n        <form className=\"footer\" onsubmit=\"return false;\">\n          <input type=\"text\" placeholder=\"Your message..\" />\n          <button type=\"submit\">Send</button>\n        </form>\n      </div>\n\n      <template data-template=\"message\">\n        <div className=\"message\">\n          <div className=\"message__name\" />\n          <div className=\"message__bubble\" />\n        </div>\n      </template>\n      <style jsx>{`\n        h1 {\n          font-family: Arial;\n        }\n        button {\n          padding: 8px;\n          margin: 0 10px;\n          font-size: 15px;\n          font-style: bold;\n          background-color: #4285f4;\n          border-radius: 3px;\n          color: white;\n          border: none;\n        }\n        .content {\n          box-shadow: rgba(156, 172, 172, 0.2) 0px 2px 2px,\n            rgba(156, 172, 172, 0.2) 0px 4px 4px,\n            rgba(156, 172, 172, 0.2) 0px 8px 8px,\n            rgba(156, 172, 172, 0.2) 0px 16px 16px,\n            rgba(156, 172, 172, 0.2) 0px 32px 32px,\n            rgba(156, 172, 172, 0.2) 0px 64px 64px;\n          border-radius: 3px;\n          height: 100vh;\n          max-height: 600px;\n          width: 100vw;\n          max-width: 400px;\n          display: flex;\n          flex-direction: column;\n        }\n        .messages {\n          flex-grow: 1;\n          padding: 20px 30px;\n          overflow: auto;\n        }\n        .message {\n          display: flex;\n          flex-direction: column;\n        }\n        .message--mine {\n          align-items: flex-end;\n        }\n        .message--theirs {\n          align-items: flex-start;\n        }\n        .message__name {\n          padding: 10px 0;\n        }\n        .message__bubble {\n          padding: 20px;\n          border-radius: 3px;\n        }\n        .message--theirs .message__bubble {\n          background: #6363bf;\n          color: white;\n        }\n        .message--mine .message__bubble {\n          background: rgba(156, 172, 172, 0.2);\n        }\n        .footer {\n          line-height: 76px;\n          border-top: 1px solid rgba(156, 172, 172, 0.2);\n          display: flex;\n          flex-shrink: 0;\n        }\n        input {\n          height: 76px;\n          border: none;\n          flex-grow: 1;\n          padding: 0 30px;\n          font-size: 16px;\n          background: transparent;\n        }\n        button {\n          border: none;\n          background: transparent;\n          padding: 0 30px;\n          font-size: 16px;\n          cursor: pointer;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default IndexPage;\n","module.exports = require(\"core-js/library/fn/array/is-array\");","module.exports = require(\"core-js/library/fn/get-iterator\");","module.exports = require(\"next/head\");","module.exports = require(\"react\");","module.exports = require(\"styled-jsx/style\");"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AADA;AAFA;AACA;AAOA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;;;;;;;;;;;;;;;;;;;ACvIA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAJA;AACA;AAYA;;;;;;;;;;;ACfA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzBA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAnCA;AAAA;AAAA;AAwHA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC7IA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;A","sourceRoot":""}